---
- hosts: all
  remote_user: root
  connection: paramiko
  accelerate: false
  tasks:
  - name: install sudo 
    pkgng: name=sudo state=present
    when: ansible_os_family == "FreeBSD"

  - name: ansible group
    group: name=ansible state=present

  - name: add ansible user
    action: user name=ansible 
      shell=/bin/sh 
      group=ansible 
      groups=wheel 
      append=yes
  
  - name: upload ansible key
    authorized_key: user=ansible
      key="{{ lookup('file', '/home/matt/.ssh/ansible_rsa.pub') }}"

  - name: easy-sudoers
    template: src=/home/matt/dotfiles/easy-sudoers.j2
      dest=/usr/local/etc/sudoers.conf
      validate='visudo -cf %s'
    when: ansible_os_family != "OpenBSD"

  - name: OpenBSD easy-sudoers
    template: src=/home/matt/dotfiles/OpenBSD/sudoers.j2
      dest=/etc/sudoers
      validate='visudo -cf %s'
    when: ansible_os_family == "OpenBSD"

  - name: add dependencies for accelerated mode
    pkgng: name={{ item }} state=present
    with_items:
    - py27-asn1
    - py27-keyczar
